# КР-3 КПО
## Микросервисы:
## 1. OrdersService
### 1. Реализован Transactional Outbox:
#### UseCases.CreateOrder - Создание заказа и запись OutboxMessage в бд
#### UseCases.CreatePaymentTask - Отправка сообщений о заказе в Kafka
### 2. Transactional inbox - не реализован, но многократное применение изменения статуса ничего не ломает
## 2. OrdersService.Tests
### Тестируется только создание заказа и запись Outbox сообщения в бд, для остальных UseCases необходим второй микросервис и Kafka
## 3. PaymentsService
### 1. Реализован Transactional Outbox:
#### UseCases.ProcessPayment - реализует проведения оплаты счёта и в зависимости от результата записывает Outbox сообщение об успехе/неуспехе
#### UseCases.OrderStatusUpdate - Отправка сообщений о смене статуса заказа в Kafka
### 2. Реализован Transactional Inbox:
#### UseCases.ConsumePayment - получает сообщение от Kafka и записывает Inbox сообщение в бд
#### UseCases.ProcessPayment - получает не исполненные Inbox сообщения и пытается выполнить их, если к моменту применения операции InboxMessageProcessed будет существовать, то операция отменится и не будет двойного списания
### 3. Compare and Swap применяется при операциях пополнения счёта и списания денег для оплаты заказа
## 4. PaymentsService.Tests
### Тестами покрыта большая часть операций:
    1. Создание счёта, который уже существует
    2. Пополнение счёта на отрицательную сумму
    3. Параллельное пополнение одного счёта - проверка работы COMPARE AND SWAP
    4. Пареллельное пополнение и списание с одного счёта - проверка работы COMPARE AND SWAP